<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.324">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Bayesian Bandit - An Analysis of Heart Disease Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The Bayesian Bandit</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/thebayesianbandit" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/brandon-scott-5a7139211/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">An Analysis of Heart Disease Data</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">analysis</div>
                <div class="quarto-category">bayesian</div>
                <div class="quarto-category">python</div>
                <div class="quarto-category">classification</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#verify-model-assumptions" id="toc-verify-model-assumptions" class="nav-link" data-scroll-target="#verify-model-assumptions">Verify Model Assumptions</a></li>
  <li><a href="#model-creation" id="toc-model-creation" class="nav-link" data-scroll-target="#model-creation">Model Creation</a></li>
  <li><a href="#model-assessment" id="toc-model-assessment" class="nav-link" data-scroll-target="#model-assessment">Model Assessment</a></li>
  <li><a href="#bayesian-model-creation" id="toc-bayesian-model-creation" class="nav-link" data-scroll-target="#bayesian-model-creation">Bayesian Model Creation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>Using data collected from hospitals in India, we demonstrate the usefulness of logistic regression in classifying patients with cardiovascular disease based on features collected by the hospital. We first present the classic approach to logistic regression (frequentist appraoch) followed by a demonstration of a bayesian approach to binary classification data. Our analysis shows that the given features and proposed inference approach prove viable and accurate methods in detecting cardiovascular disease in the sampled patients.</p>
<p>Data can be found <a href="https://www.kaggle.com/datasets/jocelyndumlao/cardiovascular-disease-dataset">here</a></p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Tests are widely used in hospitals around the world to increase the effectiveness of preventitve care. Behind these tests are statistical methods that aid doctors and other healthcare professionals in properly administering care by correctly identifying health problems. In this analysis, we analyze a dataset collected from hospitals in India that were looking for ways to identify cardiovascular diseases in their patients. The goal is to provide the hospitals with 2 things: an accurate model that predicts the presence of cardiovascular disease, and a model that helps doctors know what symptoms to watch out for when helping patients, further alerting them to either receive a test for possible cardiovascular disease or dismiss those concerns.</p>
<p>Below is the first 5 rows of the dataset that we will be analyzing.</p>
<div class="cell" data-tags="[]" data-execution_count="4">
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patientid</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">chestpain</th>
<th data-quarto-table-cell-role="th">restingBP</th>
<th data-quarto-table-cell-role="th">serumcholestrol</th>
<th data-quarto-table-cell-role="th">fastingbloodsugar</th>
<th data-quarto-table-cell-role="th">restingrelectro</th>
<th data-quarto-table-cell-role="th">maxheartrate</th>
<th data-quarto-table-cell-role="th">exerciseangia</th>
<th data-quarto-table-cell-role="th">oldpeak</th>
<th data-quarto-table-cell-role="th">slope</th>
<th data-quarto-table-cell-role="th">noofmajorvessels</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>103368</td>
<td>53</td>
<td>1</td>
<td>2</td>
<td>171</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>147</td>
<td>0</td>
<td>5.3</td>
<td>3</td>
<td>3</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>119250</td>
<td>40</td>
<td>1</td>
<td>0</td>
<td>94</td>
<td>229</td>
<td>0</td>
<td>1</td>
<td>115</td>
<td>0</td>
<td>3.7</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>119372</td>
<td>49</td>
<td>1</td>
<td>2</td>
<td>133</td>
<td>142</td>
<td>0</td>
<td>0</td>
<td>202</td>
<td>1</td>
<td>5.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>132514</td>
<td>43</td>
<td>1</td>
<td>0</td>
<td>138</td>
<td>295</td>
<td>1</td>
<td>1</td>
<td>153</td>
<td>0</td>
<td>3.2</td>
<td>2</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>146211</td>
<td>31</td>
<td>1</td>
<td>1</td>
<td>199</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>136</td>
<td>0</td>
<td>5.3</td>
<td>3</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Of the 14 columns listed above, 1 is our target column (1 for disease and 0 for no disease), 12 features that we will use to gather inference on the target, and 1 column for patientids (unique key). Gender is encoded 1 for male and 0 for female. To ensure our analysis goes smoothly, we should validate that there are no null values. If there are any, we need to construct a strategy for conserving as much information as possible. Output for the number of null values for each column is found below.</p>
<div class="cell" data-tags="[]" data-execution_count="5">
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>patientid            0
age                  0
gender               0
chestpain            0
restingBP            0
serumcholestrol      0
fastingbloodsugar    0
restingrelectro      0
maxheartrate         0
exerciseangia        0
oldpeak              0
slope                0
noofmajorvessels     0
target               0
dtype: int64</code></pre>
</div>
</div>
<p>The output shows that there are no null values for any of the columns in our dataset, so we can move onto the next step of data prep which is to verify the datatypes of each column. Essentially, we are verifying that all columns have data values that are to be expected (i.e.&nbsp;integers types for numeric columns). Output for this test is shown below.</p>
<div class="cell" data-tags="[]" data-execution_count="6">
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>patientid              int64
age                    int64
gender                 int64
chestpain              int64
restingBP              int64
serumcholestrol        int64
fastingbloodsugar      int64
restingrelectro        int64
maxheartrate           int64
exerciseangia          int64
oldpeak              float64
slope                  int64
noofmajorvessels       int64
target                 int64
dtype: object</code></pre>
</div>
</div>
<p>There doesn’t appear to be any unexpected datatypes in the dataset, so we can verify this step of data prep. More data prep can always be explored to ensure viable data for data analysis purposes, but for now we shall conclude these 2 steps are sufficient and proceed to our analysis of the data.</p>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<p>To begin our analysis, we will perform exploratory data analysis (EDA) to gather more information about how to best model our data. Below is a descriptive statistics table for our columns.</p>
<div class="cell" data-tags="[]" data-execution_count="8">
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patientid</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">chestpain</th>
<th data-quarto-table-cell-role="th">restingBP</th>
<th data-quarto-table-cell-role="th">serumcholestrol</th>
<th data-quarto-table-cell-role="th">fastingbloodsugar</th>
<th data-quarto-table-cell-role="th">restingrelectro</th>
<th data-quarto-table-cell-role="th">maxheartrate</th>
<th data-quarto-table-cell-role="th">exerciseangia</th>
<th data-quarto-table-cell-role="th">oldpeak</th>
<th data-quarto-table-cell-role="th">slope</th>
<th data-quarto-table-cell-role="th">noofmajorvessels</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.000000e+03</td>
<td>1000.00000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
<td>1000.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.048704e+06</td>
<td>49.24200</td>
<td>0.765000</td>
<td>0.980000</td>
<td>151.747000</td>
<td>311.447000</td>
<td>0.296000</td>
<td>0.748000</td>
<td>145.477000</td>
<td>0.498000</td>
<td>2.707700</td>
<td>1.540000</td>
<td>1.222000</td>
<td>0.580000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.895905e+06</td>
<td>17.86473</td>
<td>0.424211</td>
<td>0.953157</td>
<td>29.965228</td>
<td>132.443801</td>
<td>0.456719</td>
<td>0.770123</td>
<td>34.190268</td>
<td>0.500246</td>
<td>1.720753</td>
<td>1.003697</td>
<td>0.977585</td>
<td>0.493805</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.033680e+05</td>
<td>20.00000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>94.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>71.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2.536440e+06</td>
<td>34.00000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>129.000000</td>
<td>235.750000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>119.750000</td>
<td>0.000000</td>
<td>1.300000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>4.952508e+06</td>
<td>49.00000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>147.000000</td>
<td>318.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>146.000000</td>
<td>0.000000</td>
<td>2.400000</td>
<td>2.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>7.681877e+06</td>
<td>64.25000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>181.000000</td>
<td>404.250000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>175.000000</td>
<td>1.000000</td>
<td>4.100000</td>
<td>2.000000</td>
<td>2.000000</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>9.990855e+06</td>
<td>80.00000</td>
<td>1.000000</td>
<td>3.000000</td>
<td>200.000000</td>
<td>602.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>202.000000</td>
<td>1.000000</td>
<td>6.200000</td>
<td>3.000000</td>
<td>3.000000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Viewing the average for target, we get a value of .58, meaning a little more than half of our dataset contains presence of cardiovascular disease. Returning to the age column, we see that the average age is around 49 years, with the oldest being 80 and the youngest being 20. In addition, most of our dataset is compromised of males (about 77% of the dataset). Further domain knowledge is necessary to identify whether the other features respective statistics are “good” or “bad” values (healthy or not healthy).</p>
<p>While the tabular statistical information above is valiable, visual representations of the data are valiable to present so that we can quickly digest how our data looks. Below is a bar plot of the target values.</p>
<div class="cell" data-tags="[]" data-execution_count="10">
<div class="cell-output cell-output-display">
<div id="fig-target-bar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-target-bar-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.1: Bar plot of target count using seaborn. As noted from the summary statistics, the dataset contains more 1s than 0s for target, indicating a higher presence of heart disease in the sample.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can now visually see the imbalance of data in our dataset. There appears to be about 150 more 1s than 0s in the dataset. We will demonstrate later in the analysis how logistic regression is a good choice for handling unbalanced datasets. For now, we will continue to explore the dataset. While we clearly see above that there is a difference between the number of patients with and without heart disease, we should discover more information about who pertains to each target value. To do this, we can use a box-and-whisker plot to view the distribution of a variable separated by target value. Below is a box-and-whisker plot of the age distribution for 0 and 1 target values respectively.</p>
<div class="cell" data-tags="[]" data-execution_count="11">
<div class="cell-output cell-output-display">
<div id="fig-box-age" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-box-age-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.2: Box-and-whisker plot of the distribution of age between the 2 target values. While the bar plot in <a href="#fig-target-bar">Figure&nbsp;3.1</a> showed a difference in the number of each target value, this plot shows there is no big difference in age distribution between the 2 target values.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The median for each respective target value appears to be 50, with a bit more variance for target value 0 than in target value 1, probably due to a smaller sample size. Nonetheless, we see that the age distribution for those who do not have and do have heart disease appear to be approximately the same.</p>
<p>To speed up the process of EDA, we can plot several box-and-whisker plots to view distribution of many variables split by target value. <a href="#fig-box-many">Figure&nbsp;3.3</a> shows the distribution of other features in our dataset split by target value.</p>
<div class="cell" data-tags="[]" data-execution_count="12">
<div class="cell-output cell-output-display">
<div id="fig-box-many" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-box-many-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.3: A 4x2 grid of box-and-whisker plots to speed up EDA ingestion. There are a few features that appear to show differing distributions between target values, such as level of chest pain and resting BP.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Viewing a grid of box-and-whisker plots allows us to quickly review the distributions for each target value for each feature specified. There appears to be a few features that have differing distributions, such as chestpain, restingBP, and fastingbloodsugar. Clearly delineated differences between target values will be useful for our logistic regression model in identifying patients with heart disease.</p>
<p>Using the information from <a href="#fig-box-many">Figure&nbsp;3.3</a>, we can create a scatterplot to explore more in-depth the relationship between these features with differing distributions. Below in <a href="#fig-scatterplot">Figure&nbsp;3.4</a>, we show a 1x2 grid scatterplot. The left hand panel is maxheartrate by serumcholestrol and the right hand panel is restingBP by serumcholestrol.</p>
<div class="cell" data-tags="[]" data-execution_count="13">
<div class="cell-output cell-output-display">
<div id="fig-scatterplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-scatterplot-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.4: Scatterplots showing 2 quantitative variables, colored by target and symbolized by gender. The left hand panel shows maxheartrate by serumcholestrol and the right hand panel shows restingBP by serumcholestrol.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Looking at the left hand panel, we see that most of the 1 target values (heart disease) are either 0-100 or above 380ish. Most 0 values fall between 150-350ish on serumcholestrol. There does not appear to be any significant differenec between genders as they both appear to be intermixed fairly well. For the right hand panel, we see a more delineated difference for restingBP. There appears to be very few 0 values in the range of 140-200 restingBP. As well, Those above 140 restingBP and above 350 serumcholestrol appear to have a higher concentration of 1 target values. Additionally, there appears to be more males within the range of 140-180 restingBP who have target value of 1 whereas females who have a target value of 1 have a higher restingBP, more towards the range of 180-200 restingBP.</p>
<p>To explore the relationship of presence of heart disease and chestpain and noofmajorvessels, we can use countplots split by target value for each resepective level of chestpain and noofmajorvessels.</p>
<div class="cell" data-tags="[]" data-execution_count="14">
<div class="cell-output cell-output-display">
<div id="fig-count-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-count-plot-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3.5: A 1x2 grid of countplots. The left hand panel shows the counts for each bucket of chestpain split by target value. The right hand panel shows the counts for each bucket of noofmajorvessels split by target value.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>In the left hand panel of <a href="#fig-count-plot">Figure&nbsp;3.5</a>, we see that as the level of chest pain increases, the proportion of those who have heart disease increase. Additionally, in the right hand panel, as we increase in noofmajorvessels, there is a greater proprotion of those who have heart disease.</p>
</section>
<section id="verify-model-assumptions" class="level1">
<h1>Verify Model Assumptions</h1>
<p>In order to properly model this data using logistic regression, we need to verify a few assumptions. First, we need to verify that our observations are independent of one another, that is that no observation mathematically influences any other observation. Thinking logically, we can verify this assumption that someone’s restingBP does not affect any other restingBP, and so forth for every feature found in the dataset. Therefore, we can model our dataset as shown in <a href="#eq-bern">Equation&nbsp;4.1</a>.</p>
<p><span id="eq-bern"><span class="math display">\[
X_1, ... ,X_n \sim \text{ i.i.d. Bernoulli(p)}
\tag{4.1}\]</span></span></p>
<p>The second assumption we should verify is that of multicollinearity. Multicollinearity occurs when features of a dataset are highly correlated with one another. This results in variance inflation which throws off the standard errors used in statistical modeling calculations. Below are the respective VIF scores for each feature in the dataset.</p>
<div class="cell" data-tags="[]" data-execution_count="17">
<div class="cell-output cell-output-stdout">
<pre><code>    vif_factor           features
0     7.407596                age
1     4.817933             gender
2     2.769973          chestpain
3    19.558195          restingBP
4     6.841284    serumcholestrol
5     1.631514  fastingbloodsugar
6     2.275207    restingrelectro
7    15.313735       maxheartrate
8     1.957391      exerciseangia
9     4.107705            oldpeak
10    6.588688              slope
11    3.622189   noofmajorvessels</code></pre>
</div>
</div>
<p>A general rule of thumb is that VIF scores above 10 should be eliminated. Therefore, we will remove restingBP and maxheartrate from the dataset in order to verify the assumption of multicollinearity.</p>
<div class="cell" data-tags="[]" data-execution_count="18">
<div class="cell-output cell-output-stdout">
<pre><code>   vif_factor           features
0    5.686277                age
1    4.227614             gender
2    2.769430          chestpain
3    5.649147    serumcholestrol
4    1.629010  fastingbloodsugar
5    2.247908    restingrelectro
6    1.883431      exerciseangia
7    4.075928            oldpeak
8    6.053960              slope
9    3.597850   noofmajorvessels</code></pre>
</div>
</div>
<p>As we can see above in the new VIF scores, none of the scores are above 10 so we will accept these features as passed for the multicollinearity assumption.</p>
<p>The last assumption we will verify for our logistic regression model is the linearity assumption, or better said, the monotonicity assumption. We assume that each feature has a monotonic relationship with the target (response) variable. Below, we view this relationship in <a href="#fig-mono-plot">Figure&nbsp;4.1</a></p>
<div class="cell" data-tags="[]" data-execution_count="19">
<div class="cell-output cell-output-display">
<div id="fig-mono-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-mono-plot-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: A 2x5 grid of logistic regression plots, modeling the relationship between a given feature and the target variable. Each feature should have an approximate monotonic relationship with the target variable in order to verify the assumption of monotonicity.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>From <a href="#fig-mono-plot">Figure&nbsp;4.1</a>, we see that each plot demonstrates a monotonic-esque relationship. Therefore, we can verify the monotonicity assumption.</p>
</section>
<section id="model-creation" class="level1">
<h1>Model Creation</h1>
<p>Using <a href="#eq-bern">Equation&nbsp;4.1</a>, we can model our data using the <em>logit</em> function to create a linear relationship with the betas and features and the log-odds of the data. This relationship is shown in <a href="#eq-log-model">Equation&nbsp;5.1</a>.</p>
<p><span id="eq-log-model"><span class="math display">\[
\text{log}(\frac{p(X)}{1-p(X)}) = \beta_0 + \beta_1x_1 ... + \beta_px_p
\tag{5.1}\]</span></span></p>
<p>After fitting <a href="#eq-log-model">Equation&nbsp;5.1</a> to our data, we obtain the below results.</p>
<div class="cell" data-tags="[]" data-execution_count="22">
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:                 target   No. Observations:                  750
Model:                            GLM   Df Residuals:                      739
Model Family:                Binomial   Df Model:                           10
Link Function:                  Logit   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -78.442
Date:                Fri, 12 Jan 2024   Deviance:                       156.88
Time:                        12:38:31   Pearson chi2:                     349.
No. Iterations:                     9   Pseudo R-squ. (CS):             0.6830
Covariance Type:            nonrobust                                         
=====================================================================================
                        coef    std err          z      P&gt;|z|      [0.025      0.975]
-------------------------------------------------------------------------------------
const               -10.4812      1.364     -7.682      0.000     -13.156      -7.807
age                  -0.0008      0.012     -0.066      0.947      -0.025       0.023
gender                2.4959      0.565      4.418      0.000       1.389       3.603
chestpain             1.2328      0.255      4.836      0.000       0.733       1.733
serumcholestrol       0.0012      0.002      0.696      0.487      -0.002       0.004
fastingbloodsugar     0.8571      0.506      1.695      0.090      -0.134       1.848
restingrelectro       1.2382      0.316      3.920      0.000       0.619       1.857
exerciseangia        -0.3699      0.435     -0.849      0.396      -1.223       0.484
oldpeak              -1.1640      0.208     -5.589      0.000      -1.572      -0.756
slope                 7.1061      0.840      8.460      0.000       5.460       8.752
noofmajorvessels      0.1789      0.232      0.770      0.441      -0.276       0.634
=====================================================================================</code></pre>
</div>
</div>
<p>In the results above, of the features in the dataset fitted to the model, 5 of them are statistically significant (gender, chestpain, restingelectro, oldpeak, and slope). Of those 5 stat sig. features, only 1 of them has an average negative log-odds effect on classification of heart-disease (oldpeak).</p>
<p>While viewing these betas in their log-odds form is helpful to indicate whether a feature positively or negatively influence the classification of heart-disease, transforming these values into probabilities may be easier to interpret. Below, we transform the betas to probabilities.</p>
<div class="cell" data-tags="[]" data-execution_count="23">
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>const                0.000028
age                  0.499799
gender               0.923852
chestpain            0.774311
serumcholestrol      0.500289
fastingbloodsugar    0.702057
restingrelectro      0.775258
exerciseangia        0.408566
oldpeak              0.237940
slope                0.999181
noofmajorvessels     0.544604
dtype: float64</code></pre>
</div>
</div>
<p>For example, on average, an increase of 1 in slope results in a .99 factor increase of having heart disease, holding all else constant. It appears that slope and gender have the highest probability factor increase in having heart disease. Let us use these factors to see what the model would predict for the following mock data set: male, age 25, no chest pain, 100 serum cholestrol, 0 fasting blood sugar, resting electro 0, exerciseangia 0, oldpeak 1, slope 0, and noofmajorvessels 0.</p>
<div class="cell" data-tags="[]" data-execution_count="24">
<div class="cell-output cell-output-stdout">
<pre><code>Log-odds:  0.000117
Odds-ratio:  1.000117
Probability:  0.500029</code></pre>
</div>
</div>
<p>The results above show that our model precicts, on average, that a person with the above characteristics would have an odds-ratio of about 1, or a probability of about 50% of having heart disease. Some may be confused by this result, as the above parameters show increases in probability that should result in a value closer than 1 for an additive model. However, one must remember that it is an additive model by logit (see <a href="#eq-log-model">Equation&nbsp;5.1</a>). To obtain probabilities, we have to inverse the logit function to isolate <span class="math inline">\(p(X)\)</span>, as shown in <a href="#eq-log-prob">Equation&nbsp;5.2</a>.</p>
<p><span id="eq-log-prob"><span class="math display">\[
p(X) = \frac{e^{\beta_0 + \beta_1x_1 ... + \beta_px_p}}{1 + e^{\beta_0 + \beta_1x_1 ... + \beta_px_p}}
\tag{5.2}\]</span></span></p>
</section>
<section id="model-assessment" class="level1">
<h1>Model Assessment</h1>
<p>As shown above, our logistic regression model now has predictive capabilties after being fit to the data. In order to gather a general idea of how well it does on testing data, we will perform a validation test set approach, where we withhold 25% of the data to be our test set and 75% of our data will be used as training data for the model. Afterwards, we can evaluate the predictive capability of our model by assessing its roc curve and auc score. These can be found in <a href="#fig-roc-plot">Figure&nbsp;6.1</a></p>
<div class="cell" data-tags="[]" data-execution_count="26">
<div class="cell-output cell-output-display">
<div id="fig-roc-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-roc-plot-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.1: ROC curve showing how the logistic regression model performed on the test set, with corresponding auc score in bottom right-hand corner of plot.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Our ROC curve in <a href="#fig-roc-plot">Figure&nbsp;6.1</a> shows a nice elbow feature, indicating that our model performs very well at indicating true positives. In addition, our AUC score of .99 shows that our model performs very well at distinguishing between the true positives and false positives, meaning we have very good predictive performance in our logistic regression model. Using these metrics, we can find the optimal classification threshold that maximizes the true positive rate and minimizes that false positive rate. Below is our optimal threshold.</p>
<div class="cell" data-tags="[]" data-execution_count="27">
<div class="cell-output cell-output-stdout">
<pre><code>0.6519052347690012</code></pre>
</div>
</div>
<p>Our optimal threshold of approximately .65 indicates that we would classify anyone with a probability of heart disease above 65% as 1 (having heart disease) and anyone below 65% probability will be classified as 0 (no heart disease). We can use this value on our test set to create a confusion matrix and see the exact number of true positives and false positives. We can then utilize those numbers to calculate other metrics for model assessment such as sensitivity and specificity. The confusion matrix is found in <a href="#fig-conf-mat">Figure&nbsp;6.2</a>.</p>
<div class="cell" data-tags="[]" data-execution_count="29">
<div class="cell-output cell-output-display">
<div id="fig-conf-mat" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="heart_disease_analysis_files/figure-html/fig-conf-mat-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.2: Confusion matrix for our logistic regression model. The y axis indicates the true labels of the data and the x axis indicate the predicted label from our model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As we can see in the confusion matrix, our model does a great job at predicting true positives and true negatives. The model only mispredicted 1 true negative (generated 1 false negative) and mispredicted 7 true positives (generated 7 false positives). As mentioned above, we can use these numbers to view just how well our model does at identifying true positives and true negatives. Below are the metrics we calculated.</p>
<div class="cell" data-tags="[]" data-execution_count="30">
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy:  0.968
Sensitivity:  0.9507
Specificity:  0.9907
PPV:  0.9926
NPV:  0.9386</code></pre>
</div>
</div>
<p>As shown above, even in our inbalanced data set, we achieved an accuracy of about 97%. Additionally, our sensitivity shows our model is very good at identifying true positives, scoring about 95%. Our specificity score was even better, scoring a 99%, meaning our model is almost perfect at identifying those who do not have the disease (true negatives). Positive predictive value and negative predictive value also prove to be very good, with 99% and 93% respectively. For PPV, this means the probability someone has the disease, given that they tested positive (classified as a 1), is 99%. For NPV, this means the probability someone doesn’t have the disease, given they tested negative (classified as a 0), is 93%.</p>
<p>This numbers, when we take into account our threshold value (.65), makes sense since we classify people with heart disease if and only if they are above 65% probability. Otherwise, they are classified as not having heart disease. For reference on how we calculated the above values, see <a href="#eq-conf-met">Equation&nbsp;6.1</a>.</p>
<p><span class="math display">\[
Sensitivity = \frac{TP}{TP+FN}
\]</span></p>
<p><span class="math display">\[
Specificity = \frac{TN}{TN+FP}
\]</span></p>
<p><span class="math display">\[
PPV = \frac{TP}{TP+FP}
\]</span></p>
<p><span id="eq-conf-met"><span class="math display">\[
NPV = \frac{TN}{TN+FN}
\tag{6.1}\]</span></span></p>
</section>
<section id="bayesian-model-creation" class="level1">
<h1>Bayesian Model Creation</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>